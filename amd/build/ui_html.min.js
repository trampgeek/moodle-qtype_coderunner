define(["jquery"],function(a){function b(b,c,d,e){this.textArea=a(document.getElementById(b)),this.html=this.textArea.attr("data-globalextra"),this.readOnly=this.textArea.prop("readonly"),this.templateParams=e,this.fail=!1,this.htmlDiv=null,this.reload()}return b.prototype.failed=function(){return this.fail},b.prototype.sync=function(){var b,c={},d=!0;this.getFields().each(function(){var e,f;f=a(this).attr("type"),b=a(this).attr("name"),e="checkbox"!==f&&"radio"!==f||a(this).is(":checked")?a(this).val():"",c.hasOwnProperty(b)?c[b].push(e):c[b]=[e],""!==e&&(d=!1)}),d?this.textArea.val(""):this.textArea.val(JSON.stringify(c))},b.prototype.getElement=function(){return this.htmlDiv},b.prototype.getFields=function(){return a(this.htmlDiv).find(".coderunner-ui-element")},b.prototype.setField=function(a,b){"checkbox"===a.attr("type")||"radio"===a.attr("type")?a.prop("checked",a.val()===b):a.val(b)},b.prototype.reload=function(){var b,c,d,e,f,g=a(this.textArea).val(),h="<div style='height:fit-content' class='qtype-coderunner-html-outer-div'>";if(this.htmlDiv=a(h+this.html+"</div>"),this.htmlDiv.data("templateparams",this.templateParams),g)try{b=JSON.parse(g),f={};for(var i in b){for(c=b[i],e=this.getFields().filter("[name='"+i+"']"),f[i]=[],d=0;d<c.length;d++)d<e.length?this.setField(a(e[d]),c[d]):f[i].push(c[d]);0===f[i].length&&delete f[i]}a.isEmptyObject(f)||this.htmlDiv.data("leftovers",f)}catch(j){alert("Failed to initialise HTML UI"),this.fail=!0}},b.prototype.resize=function(){},b.prototype.hasFocus=function(){var a=!1;return this.getFields().each(function(){this===document.activeElement&&(a=!0)}),a},b.prototype.destroy=function(){this.sync(),a(this.htmlDiv).remove(),this.htmlDiv=null},{Constructor:b}});