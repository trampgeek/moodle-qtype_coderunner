/**
 * JavaScript for handling textareas and form actions in CodeRunner question
 * editing forms and student question answering forms.
 *
 * @module qtype_coderunner/textareas
 * @copyright  Richard Lobb, 2015, The University of Canterbury
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("qtype_coderunner/textareas",["jquery"],(function($){function initTextArea(){$(this).data("clickInProgress",!1),$(this).data("capturingTab",!0),$(this).on("mousedown",(function(){$(this).data("clickInProgress",!0)})),$(this).on("focusin",(function(){$(this).data("capturingTab",$(this).data("clickInProgress"))})),$(this).on("click",(function(){$(this).data("clickInProgress",!1)})),$(this).on("keydown",(function(e){if(!(window.hasOwnProperty("behattesting")&&window.behattesting||void 0!==e.which&&0===e.which))if(9==e.keyCode&&$(this).data("capturingTab"))(e.shiftKey||insertString(this,"    "))&&e.preventDefault();else if(13===e.keyCode&&void 0!==this.selectionStart){for(var before=this.value.substring(0,this.selectionStart),eol=before.lastIndexOf("\n"),line=before.substring(eol+1),indent="",i=0;i<line.length&&" "===line.charAt(i);i++)indent+=" ";insertString(this,"\n"+indent)&&e.preventDefault(),$(this).data("capturingTab",!0)}else 77===e.keyCode&&e.ctrlKey&&!e.altKey?($(this).data("capturingTab",!$(this).data("capturingTab")),e.preventDefault()):27===e.keyCode?$(this).data("capturingTab",!1):e.ctrlKey||e.altKey||$(this).data("capturingTab",!0)}))}function insertString(ta,sToInsert){if(void 0!==ta.selectionStart){var before=ta.value.substring(0,ta.selectionStart),selSave=ta.selectionEnd,after=ta.value.substring(ta.selectionEnd,ta.value.length),tmp=ta.scrollTop;ta.value=before+sToInsert+after;var pos=selSave+sToInsert.length;return ta.selectionStart=pos,ta.selectionEnd=pos,ta.scrollTop=tmp,!0}if(document.selection&&document.selection.createRange){var r=document.selection.createRange(),dr=r.duplicate();return dr.moveToElementText(ta),dr.setEndPoint("EndToEnd",r),r.text=sToInsert,!0}return!1}return{setupAllTAs:function(){$("div.edit_code textarea").each(initTextArea)},initQuestionTA:function(taId){$(document.getElementById(taId)).each(initTextArea)},setupShowHideAnswer:function(linkId,divId){let link=$(document.getElementById(linkId)),div=$(document.getElementById(divId)),hdr=link.children()[0],hdrText=hdr.innerText;link.click((()=>{div.is(":visible")?(div.hide(),hdr.innerText=hdrText.replace("▾","▸")):(div.show(),div.trigger("mousemove"),hdr.innerText=hdrText.replace("▸","▾"))}))}}}));

//# sourceMappingURL=textareas.min.js.map